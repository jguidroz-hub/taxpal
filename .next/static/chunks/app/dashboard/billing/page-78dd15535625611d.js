(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[613],{63:(e,t,a)=>{"use strict";var r=a(7260);a.o(r,"useRouter")&&a.d(t,{useRouter:function(){return r.useRouter}}),a.o(r,"useSearchParams")&&a.d(t,{useSearchParams:function(){return r.useSearchParams}})},3926:(e,t,a)=>{Promise.resolve().then(a.bind(a,4708))},4708:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>c});var r=a(5155),s=a(2115),n=a(8347),i=a(63),l=a(2619),d=a.n(l);function c(){let{isLoading:e}=function(){let{data:e,status:t}=(0,n.wV)(),a=(0,i.useRouter)();return(0,s.useEffect)(()=>{"unauthenticated"===t&&a.push("/login")},[t,a]),{session:e,user:null==e?void 0:e.user,isLoading:"loading"===t,isAuthenticated:"authenticated"===t}}(),[t,a]=(0,s.useState)(null),[l,c]=(0,s.useState)(!0),[o,u]=(0,s.useState)(!1);(0,s.useEffect)(()=>{fetch("/api/billing/subscription").then(e=>e.json()).then(e=>{a(e.subscription),c(!1)}).catch(()=>c(!1))},[]);let m=async e=>{u(!0);try{let t=await fetch("/api/billing/subscription",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:e})}),r=await t.json();if(!t.ok)return void alert(r.error);let s=await fetch("/api/billing/subscription").then(e=>e.json());a(s.subscription)}catch(e){alert("Failed to update subscription")}finally{u(!1)}},g=async()=>{u(!0);try{let e=await fetch("/api/billing/portal",{method:"POST"}),t=await e.json();t.url?window.location.href=t.url:alert("Failed to open billing portal")}catch(e){alert("Failed to open billing portal")}finally{u(!1)}};if(e||l)return(0,r.jsx)("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-950 flex items-center justify-center",children:(0,r.jsx)("div",{className:"animate-pulse text-gray-400",children:"Loading billing..."})});let x=e=>e?new Date(e).toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"}):"—";return(0,r.jsxs)("div",{className:"max-w-3xl mx-auto px-6 py-8",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-8",children:"Billing"}),(0,r.jsxs)("div",{className:"bg-white dark:bg-gray-900 rounded-xl border border-gray-200 dark:border-gray-800 p-6 mb-6",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,r.jsx)("h2",{className:"text-lg font-semibold",children:"Current Plan"}),t&&(e=>{let t={active:"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400",trialing:"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400",past_due:"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400",canceled:"bg-gray-100 text-gray-700 dark:bg-gray-800 dark:text-gray-400"};return(0,r.jsx)("span",{className:"inline-flex px-2.5 py-1 rounded-full text-xs font-medium ".concat(t[e]||t.canceled),children:e.replace("_"," ")})})(t.status)]}),t?(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,r.jsx)("span",{className:"text-gray-500",children:"Status"}),(0,r.jsx)("span",{className:"font-medium",children:t.status})]}),t.currentPeriodEnd&&(0,r.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,r.jsx)("span",{className:"text-gray-500",children:t.cancelAtPeriodEnd?"Access until":"Next billing date"}),(0,r.jsx)("span",{className:"font-medium",children:x(t.currentPeriodEnd)})]}),t.trialEnd&&(0,r.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,r.jsx)("span",{className:"text-gray-500",children:"Trial ends"}),(0,r.jsx)("span",{className:"font-medium",children:x(t.trialEnd)})]}),t.cancelAtPeriodEnd&&(0,r.jsxs)("div",{className:"mt-4 bg-yellow-50 dark:bg-yellow-900/20 rounded-lg p-3 text-sm text-yellow-700 dark:text-yellow-400",children:["Your subscription will cancel on ",x(t.currentPeriodEnd),"."," ",(0,r.jsx)("button",{onClick:()=>m("reactivate"),disabled:o,className:"underline font-medium hover:no-underline",children:"Reactivate"})]}),"past_due"===t.status&&(0,r.jsxs)("div",{className:"mt-4 bg-red-50 dark:bg-red-900/20 rounded-lg p-3 text-sm text-red-700 dark:text-red-400",children:["Your last payment failed. Please update your payment method to avoid losing access.",(0,r.jsx)("button",{onClick:g,disabled:o,className:"underline font-medium hover:no-underline ml-1",children:"Update payment →"})]})]}):(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-gray-500 mb-4",children:"You're on the free plan."}),(0,r.jsx)(d(),{href:"/pricing",className:"inline-block bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium transition",children:"Upgrade →"})]})]}),t&&(0,r.jsxs)("div",{className:"bg-white dark:bg-gray-900 rounded-xl border border-gray-200 dark:border-gray-800 p-6 mb-6",children:[(0,r.jsx)("h2",{className:"text-lg font-semibold mb-4",children:"Manage Subscription"}),(0,r.jsxs)("div",{className:"flex flex-wrap gap-3",children:[(0,r.jsx)("button",{onClick:g,disabled:o,className:"bg-gray-100 dark:bg-gray-800 hover:bg-gray-200 dark:hover:bg-gray-700 px-4 py-2 rounded-lg text-sm font-medium transition disabled:opacity-50",children:"Payment Method & Invoices"}),(0,r.jsx)(d(),{href:"/pricing",className:"bg-gray-100 dark:bg-gray-800 hover:bg-gray-200 dark:hover:bg-gray-700 px-4 py-2 rounded-lg text-sm font-medium transition",children:"Change Plan"}),"active"===t.status&&!t.cancelAtPeriodEnd&&(0,r.jsx)("button",{onClick:()=>{confirm("Are you sure you want to cancel? You'll keep access until the end of your billing period.")&&m("cancel")},disabled:o,className:"text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 px-4 py-2 rounded-lg text-sm font-medium transition disabled:opacity-50",children:"Cancel Subscription"})]})]}),(0,r.jsxs)("div",{className:"bg-white dark:bg-gray-900 rounded-xl border border-gray-200 dark:border-gray-800 p-6",children:[(0,r.jsx)("h2",{className:"text-lg font-semibold mb-4",children:"Billing FAQ"}),(0,r.jsxs)("div",{className:"space-y-4 text-sm text-gray-600 dark:text-gray-400",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"font-medium text-gray-900 dark:text-white",children:"How do I update my payment method?"}),(0,r.jsx)("p",{children:"Click “Payment Method & Invoices” above to access the Stripe customer portal."})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"font-medium text-gray-900 dark:text-white",children:"What happens if I cancel?"}),(0,r.jsx)("p",{children:"You'll keep access until the end of your current billing period. No refund for partial months."})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"font-medium text-gray-900 dark:text-white",children:"Can I get a refund?"}),(0,r.jsx)("p",{children:"We offer a 30-day money-back guarantee. Contact support@projectgreenbelt.com within 30 days of your first payment."})]})]})]})]})}}},e=>{e.O(0,[619,347,441,255,358],()=>e(e.s=3926)),_N_E=e.O()}]);